<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports - SmartStudy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #000;
            color: white;
        }

        .card {
            background: white;
            color: black;
        }
    </style>
</head>

<body class="min-h-screen">


    <header class="bg-black border-b border-white-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0">
                    <a href="{{ url_for('dashboard') }}"
                        class="text-2xl font-bold text-white hover:text-indigo-600 transition">SmartStudy</a>
                </div>
                <div class="flex space-x-4">
                    <a href="{{ url_for('dashboard') }}"
                        class="text-white hover:text-indigo-600 px-3 py-2 rounded-md font-medium">Dashboard</a>
                    <a href="{{ url_for('subjects') }}"
                        class="text-white hover:text-indigo-600 px-3 py-2 rounded-md font-medium">My Subjects</a>
                    <a href="{{ url_for('reports') }}"
                        class="text-white hover:text-indigo-600 px-3 py-2 rounded-md font-medium">Reports</a>
                    <a href="{{ url_for('logout') }}"
                        class="text-red-600 hover:text-red-700 px-3 py-2 rounded-md font-medium">Logout</a>
                </div>
            </div>
        </div>
    </header>


    <div class="fixed top-0 left-1/2 -translate-x-1/2 z-50 p-4 w-full max-w-sm">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="p-3 mb-2 text-sm text-center rounded-lg 
                    {% if category == 'error' %} bg-red-100 text-red-700 border border-red-400
                    {% else %} bg-green-100 text-green-700 border border-green-400 {% endif %}" role="alert">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}
    </div>


    <div class="container my-5 text-white">
        <h1 class="mb-4">Reports</h1>

        <!-- Summary Cards -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card p-3 mb-3 text-center">
                    <h5>Total Subjects</h5>
                    <h2>{{ total_subjects }}</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card p-3 mb-3 text-center">
                    <h5>Completed Subjects</h5>
                    <h2>{{ completed_subjects }}</h2>
                    <small>{{ (completed_subjects / total_subjects * 100) if total_subjects else 0 }}%</small>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card p-3 mb-3 text-center">
                    <h5>Pending Subjects</h5>
                    <h2>{{ pending_subjects }}</h2>
                    <small>{{ (pending_subjects / total_subjects * 100) if total_subjects else 0 }}%</small>
                </div>
            </div>
        </div>

        <!-- Topics Summary -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card p-3 mb-3 text-center">
                    <h5>Total Topics</h5>
                    <h2>{{ total_topics }}</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card p-3 mb-3 text-center">
                    <h5>Completed Topics</h5>
                    <h2>{{ completed_topics }}</h2>
                    <small>{{ (completed_topics / total_topics * 100) if total_topics else 0 }}%</small>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card p-3 mb-3 text-center">
                    <h5>Pending Topics</h5>
                    <h2>{{ pending_topics }}</h2>
                    <small>{{ (pending_topics / total_topics * 100) if total_topics else 0 }}%</small>
                </div>
            </div>
        </div>

        <!-- Subject Progress Bars -->
        <h4 class="mb-3">Subject Progress</h4>
        {% for subject in subject_progress %}
        <div class="mb-3">
            <div class="d-flex justify-content-between text-white">
                <span>{{ subject.name }}</span>
                <span>{{ subject.progress|default(0) }}%</span>
            </div>
            <div class="progress">
                <div class="progress-bar" role="progressbar" style="width: {{ subject.progress|default(0) }}%;"
                    aria-valuenow="{{ subject.progress|default(0) }}" aria-valuemin="0" aria-valuemax="100">
                </div>
            </div>
        </div>
        {% else %}
        <p class="text-white">No subjects added yet.</p>
        {% endfor %}

        <!-- Chart Section -->
        <h4 class="mt-5 mb-3">Topics Completion Chart</h4>
        <canvas id="topicsChart" height="100" class="bg-white p-4 rounded"></canvas>

        <!-- Recent Subtopics -->
        <h4 class="mt-5 mb-3">Recent Subtopics</h4>
        <ul class="list-group mb-5">
            {% for subtopic in recent_subtopics %}
            <li class="list-group-item">
                {{ subtopic.name }} ({{ subtopic.topic.name }}) -
                {{ "Completed" if subtopic.is_completed else "Pending" }}
            </li>
            {% else %}
            <li class="list-group-item text-muted">No subtopics added yet.</li>
            {% endfor %}
        </ul>
    </div>


    <footer class="bg-black border-t mt-8">
        <div
            class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 flex flex-col md:flex-row justify-between items-center text-white text-sm">
            <p class="mb-3 md:mb-0">&copy; 2025 SmartStudy. All rights reserved.</p>
            <div class="flex space-x-4">
                <a href="#" class="hover:text-indigo-600">Privacy Policy</a>
                <a href="#" class="hover:text-indigo-600">Terms of Service</a>
                <a href="#" class="hover:text-indigo-600">Contact</a>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById('topicsChart').getContext('2d');
        const topicsChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: [{% for subject in subject_progress %}'{{ subject.name }}',{% endfor %}],
        datasets: [{
            label: 'Completion %',
            data: [{% for subject in subject_progress %}{{ subject.progress |default(0) }}, {% endfor %}],
            backgroundColor: 'rgba(54, 162, 235, 0.6)',
                borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
        options: {
            responsive: true,
                scales: {
                y: {
                    beginAtZero: true,
                        max: 100
                }
            }
        }
        });
    </script>
</body>

</html>